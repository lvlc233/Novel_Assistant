后端待解决文档

更新时间: 2026-01-30 10:06

事项清单
1. 接口路由前缀与路径未对齐规范，需统一至文档约定路径。状态: 已完成
2. Work/Document/Memory 等响应与请求字段命名偏离规范，需统一字段语义与名称。状态: 已完成
3. 统一响应 code 类型为 int 的规范未落地，需调整模型与错误处理。状态: 已完成
<!-- 5. Agent 调用接口与 SSE 事件规范不一致，需按文档调整。状态: 未完成
6. 数据库敏感信息硬编码，需改为环境变量配置。状态: 未完成
7. ruff 检测存在大量 docstring 与导入顺序问题，需按规则修复。状态: 未完成
8. mypy 类型检查存在缺失标注与不匹配签名问题，需补齐类型。状态: 未完成
9. bandit 扫描包含本项目内的配置与异常处理告警，需按安全规范处理。状态: 未完成 -->


---
原内容
差异清单（以文档为主）

- 路由前缀与路径不一致：文档要求 /plugin 、 /work 、 /work/{work_id}/document 、 /plugin/kd 、 /plugin/memory 、 /plugin/agent/manager ；代码实际使用 /plugins 、 /works 、 /works/{work_id}/documents 、 /knowledge-bases 、 /memories 、 /agents ，会导致前后端约定失配与接口不可用。 plugin/router.py work/router.py node/router.py knowledge_base/router.py memory/router.py agent/router.py
- 响应模型字段命名不一致：文档中 Work/Document/Memory 的字段是 id/name/summary/from_node_id 等，而代码使用 work_id/works_name/fater_node_id/memory_name 等，字段语义与命名偏离规范，前端映射会出错。 work/schema.py node/schema.py memory/schema.py
- 统一响应包装中 code 类型不一致：规范要求 code:int ，当前实现为 code:str ，会造成前后端类型歧义与错误码比较不一致。 base.py
- 对外接口模型使用 Dict/Any ：规格明确禁止公共接口使用 dict/Any ，但当前 Agent/Plugin/Work 等请求与响应存在 Dict/Any 字段，违反模型契约清晰性要求。 agent/schema.py plugin/schema.py work/schema.py
- Agent 调用与 SSE 约定不一致：规范要求 POST /plugin/agent/manager/{agent_id}/history/{session_id}/messages 并用 SSE 流式返回，现实现为 /agents/{agent_id}/invoke 普通响应，缺少 SSE 流式语义。 agent/router.py
- 配置中存在硬编码敏感信息：规格强调环境变量管理，当前直接写入 POSTGRES_PASSWORD ，不符合安全规范。 config.py
检测结果

- ruff check --fix：失败，仍有大量规则问题（示例：服务层缺少 docstring、导入顺序错误等）。涉及文件包括 node/service.py memory/service.py plugin/service.py work/service.py 。
- mypy（src）：报 75 个类型问题，集中在缺少类型标注、泛型缺少类型参数、接口签名与父类不一致等（主要在 infrastructure/langgraph/checkpointer.py 、 core/agents/*/graph.py 、 common/utils.py ）。
- bandit -r .：扫描到大量第三方包告警（.venv），项目内确认项包括 0.0.0.0 绑定与 try/except/pass 使用等。 config.py utils.py
