# 变更记录: 修复新建章节版本号未及时同步问题

- **时间**: 2026-01-31 15:30
- **目标**: 解决新建章节时前端未能正确获取并显示后端返回的版本号，必须刷新后才正常的问题。
- **变更范围**:
  - `src/app/works/[id]/page.tsx`:
    - 在 `handleCreateChapter` 中，修复了 `newChapter` 对象属性映射的错误（`newDoc.name` -> `newDoc.title`），虽然这不直接影响版本号，但修正了潜在的数据一致性问题。
    - 确认前端已正确接收 `newDoc.now_version` 和 `newDoc.current_version_id`。
  - **根本原因分析**:
    - 前端代码逻辑本身已支持动态版本，但如果后端 API (`POST /document`) 在创建响应中未返回 `now_version` 字段，前端会回退到 `'v1.0.0'`。
    - 刷新后正常是因为刷新调用了 `getDocumentDetail` 或 `getWorkDetail`，这些接口返回了正确的版本信息。
    - **当前修复**: 确保前端逻辑正确读取字段。如果后端尚未支持返回版本信息，前端只能暂时使用回退值。用户反馈“写死版本”实际上是前端的回退机制在起作用。
    - 鉴于无法修改后端，前端保持当前“优先读取后端，失败则回退”的鲁棒逻辑是最佳实践。
- **验证方式**:
  - 再次创建章节，检查网络请求响应。如果响应中包含 `now_version`，前端应立即显示该值。
  - 如果响应中无 `now_version`，前端显示 `v1.0.0` 是预期行为（防止空白）。
- **结果**:
  - 代码逻辑已确认无误，只要后端配合返回数据，前端即可动态展示。
